(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1661:(e,t,o)=>{Promise.resolve().then(o.bind(o,5705))},5705:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>N});var n=o(5155),l=o(2785),a=o(5541);let c=a.sh.createBlockDefinitionsFromJsonArray([{type:"io_read_line",tooltip:"Read Line",helpUrl:"",message0:"read line",output:null,colour:270},{type:"io_read_number",tooltip:"Read Number",helpUrl:"",message0:"read number",output:null,colour:270},{type:"io_puts",tooltip:"Print",helpUrl:"",message0:"puts %1",args0:[{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,colour:270},{type:"io_read_numbers",tooltip:"Read multiple numbers",helpUrl:"",message0:"read numbers of line",output:null,colour:270}]);a.sh.defineBlocks(c);let r=a.sh.createBlockDefinitionsFromJsonArray([{type:"get_index",tooltip:"Get an item from array",helpUrl:"",message0:"%1[%2]",args0:[{type:"input_value",name:"Array"},{type:"input_value",name:"Index"}],output:null,colour:270},{type:"slice",tooltip:"Get slice from array",helpUrl:"",message0:"%1[%2,%3]",args0:[{type:"input_value",name:"String"},{type:"input_value",name:"Index"},{type:"input_value",name:"Count"}],output:null,colour:270}]);a.sh.defineBlocks(r);let i=a.sh.createBlockDefinitionsFromJsonArray([{type:"range",tooltip:"Create a range of numbers",helpUrl:"",message0:"range from %1 to %2",args0:[{type:"input_value",name:"FROM"},{type:"input_value",name:"TO"}],output:null,colour:270}]);a.sh.defineBlocks(i);let s=a.sh.createBlockDefinitionsFromJsonArray([{type:"call_method",tooltip:"Call method",helpUrl:"",message0:"%1.%2(%3)",args0:[{type:"input_value",name:"Object"},{type:"field_input",name:"Method",text:""},{type:"input_value",name:"Args"}],output:null,colour:270},{type:"times",tooltip:"Repeat a block multiple times",helpUrl:"",message0:"repeat %1 index variable %2 times %3",args0:[{type:"input_value",name:"TIMES"},{type:"field_input",name:"INDEX",text:"i"},{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,colour:270},{type:"lambda",message0:"lambda %1 do %2 return %3",args0:[{type:"field_input",name:"PARAMS",text:""},{type:"input_statement",name:"BODY"},{type:"input_value",name:"RETURN",align:"RIGHT"}],output:null,colour:230,tooltip:"Ruby lambda",helpUrl:""},{type:"call_method_with_proc",tooltip:"Call method with a Proc",helpUrl:"",message0:"%1.%2(proc %3)",args0:[{type:"input_value",name:"Object"},{type:"field_input",name:"Method",text:""},{type:"input_value",name:"Proc"}],output:null,colour:270},{type:"custom_code",tooltip:"Custom code block",helpUrl:"",message0:"%1",args0:[{type:"field_input",name:"CODE",text:""}],previousStatement:null,nextStatement:null,colour:270}]);a.sh.defineBlocks(s),Object.assign({},c,r,i,s);var u=o(2115);class p extends a.jZ{getReservedWords(){return this.RESERVED_WORDS_}getDefinitions(){return this.definitions_||{}}setDefinitions(e){this.definitions_=e}setFunctionNames(e){this.functionNames_=e}resetNameDB(){this.nameDB_&&this.nameDB_.reset()}quote_(e){return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}}let d=new p("Ruby"),m={ATOMIC:0,FUNCTION_CALL:2,EXPONENTIATION:3,MULTIPLICATIVE:5,ADDITIVE:6,RELATIONAL:11,NONE:99};for(let[e,t]of(d.init=e=>{d.nameDB_=new a.fS(d.getReservedWords()),d.nameDB_.setVariableMap(e.getVariableMap()),d.setDefinitions(Object.create({})),d.setFunctionNames(Object.create({}))},d.finish=e=>{let t=Object.values(d.getDefinitions()||{}).join("\n");return d.resetNameDB(),[t,e].filter(Boolean).join("\n\n")},d.scrub_=(e,t)=>{var o;let n=e.getCommentText(),l=n?d.prefixLines("# ".concat(n),""):"",a=null==(o=e.nextConnection)?void 0:o.targetBlock();return l+t+(a?d.blockToCode(a):"")},Object.entries({io_read_line:()=>["gets.chomp",m.ATOMIC],io_read_number:()=>["gets.to_i",m.ATOMIC],io_puts:(e,t)=>{let o=t.valueToCode(e,"VALUE",m.NONE)||'""';return"puts ".concat(o)},io_read_numbers:()=>["gets.chomp.split.map(&:to_i)",m.ATOMIC],variables_set:(e,t)=>{let o=t.valueToCode(e,"VALUE",m.NONE)||"0";return t.getVariableName(e.getFieldValue("VAR"))+" = "+o+"\n"},variables_get:(e,t)=>[t.getVariableName(e.getFieldValue("VAR")),m.ATOMIC],text:(e,t)=>{let o=e.getFieldValue("TEXT")||"";return[t.quote_(o),m.ATOMIC]},slice:(e,t)=>{let o=t.valueToCode(e,"String",m.NONE)||'""',n=t.valueToCode(e,"Index",m.NONE)||"0",l=t.valueToCode(e,"Count",m.NONE)||"0";return["".concat(o,"[").concat(n,",").concat(l,"]"),m.ATOMIC]},get_index:(e,t)=>{let o=t.valueToCode(e,"Array",m.NONE)||"[]",n=t.valueToCode(e,"Index",m.NONE)||"0";return["".concat(o,"[").concat(n,"]"),m.ATOMIC]},controls_if:(e,t)=>{let o=t.valueToCode(e,"IF0",m.NONE)||"false",n=t.statementToCode(e,"DO0")||"",l="if ".concat(o," then\n").concat(n),a=1;for(;e.getInput("IF".concat(a));){let o=t.valueToCode(e,"IF".concat(a),m.NONE)||"false",n=t.statementToCode(e,"DO".concat(a))||"";l+="\nelsif ".concat(o," then\n").concat(n),a++}if(e.getInput("ELSE")){let o=t.statementToCode(e,"ELSE");l+="\nelse\n".concat(o)}return l+"\nend\n"},logic_compare:(e,t)=>{let o={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],n=t.valueToCode(e,"A",m.RELATIONAL)||"0",l=t.valueToCode(e,"B",m.RELATIONAL)||"0";return["".concat(n," ").concat(o," ").concat(l),m.RELATIONAL]},call_method:(e,t)=>{let o=t.valueToCode(e,"Object",m.NONE)||"nil",n=e.getFieldValue("Method")||"",l=t.valueToCode(e,"Args",m.NONE)||"";return""===l?["".concat(o,".").concat(n),m.ATOMIC]:["".concat(o,".").concat(n,"(").concat(l,")"),m.ATOMIC]},times:(e,t)=>{let o=t.valueToCode(e,"TIMES",m.NONE)||"0",n=e.getFieldValue("INDEX")||"i",l=t.statementToCode(e,"DO")||"";return"".concat(o,".times do |").concat(n,"|\n").concat(l,"end\n")},lambda:(e,t)=>{let o=e.getFieldValue("PARAMS")||"",n=t.statementToCode(e,"BODY")||"",l=t.valueToCode(e,"RETURN",m.NONE)||"nil";return[""===n?"Proc.new { |".concat(o,"| ").concat(l,"}"):"Proc.new { |".concat(o,"| \n").concat(n,"\nreturn ").concat(l,"\n}"),m.FUNCTION_CALL]},call_method_with_proc:(e,t)=>{let o=t.valueToCode(e,"Object",m.NONE)||"nil",n=e.getFieldValue("Method")||"",l=t.valueToCode(e,"Proc",m.NONE)||"(Proc.new { |x| false })";return["".concat(o,".").concat(n,"(&").concat(l,")"),m.ATOMIC]},custom_code:(e,t)=>{let o=e.getFieldValue("CODE")||"";return"".concat(o,"\n")},math_number:e=>[e.getFieldValue("NUM")||"0",m.ATOMIC],math_arithmetic:(e,t)=>{let o={ADD:["+",m.ADDITIVE],MINUS:["-",m.ADDITIVE],MULTIPLY:["*",m.MULTIPLICATIVE],DIVIDE:["/",m.MULTIPLICATIVE],POWER:["**",m.EXPONENTIATION]}[e.getFieldValue("OP")],n=t.valueToCode(e,"A",o[1])||"0",l=t.valueToCode(e,"B",o[1])||"0";return["".concat(n," ").concat(o[0]," ").concat(l),o[1]]},range:(e,t)=>{let o=t.valueToCode(e,"FROM",m.NONE)||"0",n=t.valueToCode(e,"TO",m.NONE)||"0";return["(".concat(o,"..").concat(n,").to_a"),m.ATOMIC]},lists_create_with:(e,t)=>{let o=[];for(let n=0;n<e.itemCount_;n++){let l=t.valueToCode(e,"ADD".concat(n),m.NONE)||"nil";o.push(l)}return["[".concat(o.join(", "),"]"),m.ATOMIC]}})))d.forBlock[e]=t;var b=o(3603),_=o(5028),g=o(8300),h=o(5695);let y=(0,_.default)(()=>o.e(215).then(o.bind(o,9215)),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),N=()=>{let e=(0,h.useSearchParams)(),t=(0,u.useRef)(null),o=e.get("xmlBase64")||"",a=void 0!=o?atob(decodeURIComponent(o)):"{}";(0,u.useEffect)(()=>{console.log(a)},[a]);let{workspace:c,json:r,xml:i}=(0,l.P2)({ref:t,initialXml:a,toolboxConfiguration:'\n<xml>\n  <category name="IO">\n    <block type="io_read_line"/>\n    <block type="io_read_number"/>\n    <block type="io_read_numbers"/>\n    <block type="io_puts"/>\n  </category>\n  <category name="リテラル">\n    <block type="text"/>\n    <block type="math_number"/>\n  </category>\n  <category name="変数/演算">\n    <block type="variables_set"/>\n    <block type="variables_get"/>\n    <block type="math_arithmetic"/>\n    <block type="get_index"/>\n    <block type="slice"/>\n    <block type="call_method"/>\n    <block type="call_method_with_proc"/>\n    <block type="range"/>\n    <block type="lists_create_with"/>\n\x3c!--    <block type="logic_compare"/>--\x3e\n\x3c!--    <block type="text_join"/>--\x3e\n  </category>\n  <category name="制御">\n    <block type="controls_if"/>\n    <block type="logic_compare"/>\n    <block type="times"/>\n    <block type="lambda"/>\n    <block type="custom_code"/>\n  </category>\n</xml>\n',workspaceConfiguration:{horizontalLayout:!0,sounds:!1,theme:{...g.BD.Zelos,componentStyles:{...g.BD.Zelos.componentStyles,workspaceBackgroundColour:"#dfd0b8",toolboxBackgroundColour:"#222831"}}}}),[s,p]=(0,u.useState)(!1),[m,_]=(0,u.useState)("");(0,u.useEffect)(()=>{console.log(r,i)},[r,i]);let N=(0,u.useCallback)(()=>{c&&(_(d.workspaceToCode(c)),p(!0))},[c]),T=(0,u.useCallback)(()=>{m&&navigator.clipboard.writeText(m)},[m]);return(0,n.jsxs)("div",{className:"h-dvh flex flex-col",children:[(0,n.jsxs)("header",{className:"p-2 flex justify-between border-b",children:["Ruby Block Editor",(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)("button",{className:"rounded-lg bg-blue-800 px-4",onClick:()=>N(),children:"Gen Ruby"}),(0,n.jsx)("button",{className:"rounded-lg bg-blue-800 px-4",onClick:()=>(()=>{let e=encodeURIComponent(btoa(i||"")),t="".concat(location.origin).concat(location.pathname,"?xmlBase64=").concat(e);navigator.clipboard.writeText(t)})(),children:"Export"})]})]}),(0,n.jsx)("div",{className:"flex-1 z-0",children:(0,n.jsx)("div",{ref:t,className:"w-full h-full"})}),s&&(0,n.jsxs)("div",{className:"fixed inset-0 z-50 bg-white flex flex-col",children:[(0,n.jsxs)("div",{className:"p-2 flex items-center justify-between border-b bg-black",style:{paddingBottom:"calc(env(safe-area-inset-bottom)/4)"},children:[(0,n.jsx)("span",{children:"Ruby コード"}),(0,n.jsxs)("div",{className:"space-x-2",children:[(0,n.jsx)("button",{onClick:T,children:"コピー"}),(0,n.jsx)("button",{onClick:()=>p(!1),children:"閉じる"})]})]}),(0,n.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,n.jsx)(y,{value:m,className:"h-full bg-gray-100 text-gray-800",extensions:[b.Lz.editable.of(!1),b.Lz.lineWrapping],basicSetup:{highlightActiveLine:!1,highlightActiveLineGutter:!1,foldGutter:!0,lineNumbers:!0},readOnly:!0,theme:void 0})})]})]})}}},e=>{e.O(0,[79,263,370,441,964,358],()=>e(e.s=1661)),_N_E=e.O()}]);